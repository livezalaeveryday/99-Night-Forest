local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- สร้าง Window
local Window = Rayfield:CreateWindow({
   Name = "ไลฟ์สาระ ไปวันๆ v1.5 (God Mode)",
   Icon = 0,
   LoadingTitle = "ยินดีต้อนรับ Power Panel v1 สคริปต์ของไลฟ์สาระไปวันๆ",
   LoadingSubtitle = "power panel team",
   ShowText = "Rayfield",
   Theme = "Bloom",
   ToggleUIKeybind = "K",
   DisableRayfieldPrompts = true,
   DisableBuildWarnings = true,
   ConfigurationSaving = {
      Enabled = true,
      FolderName = nil,
      FileName = "Big Hub"
   },
   Discord = {
      Enabled = false,
      Invite = "noinvitelink",
      RememberJoins = true
   },
   KeySystem = false,
   KeySettings = {
      Title = "ระบบคีย์",
      Subtitle = "ไปหาซื้อคีย์มาใส่",
      Note = "No method of obtaining the key is provided",
      FileName = "Key",
      SaveKey = true,
      GrabKeyFromSite = false,
      Key = {"Hello"}
   }
})

-- ปุ่มมือถือ
local MobileButton = Instance.new("TextButton")
MobileButton.Size = UDim2.new(0,100,0,50)
MobileButton.Position = UDim2.new(0,10,0,10)
MobileButton.Text = "Rayfield"
MobileButton.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
MobileButton.MouseButton1Click:Connect(function()
    Window:Toggle()
end)

-- ตัวแปรระบบ
local Players = game:GetService("Players")
local RS = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")
local humanoid = char:WaitForChild("Humanoid")

-- ตัวแปรฟังก์ชัน
local flying = false
local vv, gyro
local flySpeed = 50
local superSpeed = false
local runSpeed = 32
local noclipEnabled = false
local infJumpEnabled = false

-- === ฟังก์ชันบิน ===
local function startFlying()
    if flying then return end
    flying = true
    humanoid.PlatformStand = true
    vv = Instance.new("BodyVelocity")
    vv.MaxForce = Vector3.new(1e5,1e5,1e5)
    vv.P = 1250
    vv.Velocity = Vector3.zero
    vv.Parent = hrp
    gyro = Instance.new("BodyGyro")
    gyro.MaxTorque = Vector3.new(4e5,4e5,4e5)
    gyro.P = 3000
    gyro.CFrame = hrp.CFrame
    gyro.Parent = hrp
    Rayfield:Notify({Title = "โหมดบินเปิด!", Content = "ใช้ W,A,S,D,Space,Ctrl เพื่อควบคุม", Duration = 3, Image = 6026568198})
end

local function stopFlying()
    if not flying then return end
    flying = false
    if vv then vv:Destroy() vv=nil end
    if gyro then gyro:Destroy() gyro=nil end
    humanoid.PlatformStand = false
    Rayfield:Notify({Title = "โหมดบินปิด", Content = "ลงจอดเรียบร้อย", Duration = 3, Image = 6026568198})
end

-- ฟังก์ชันวิ่งเร็ว
local function toggleSpeed(on)
    superSpeed = on
    humanoid.WalkSpeed = superSpeed and runSpeed or 16
    Rayfield:Notify({Title = superSpeed and "วิ่งเร็วเปิด" or "วิ่งเร็วปิด", Content = superSpeed and "วิ่งเร็วสุดขีด!" or "กลับสู่ความเร็วปกติ", Duration = 3, Image = 6023426921})
end

-- === แท็บตัวละคร ===
local MainTab = Window:CreateTab("ตัวละคร", 6026568198)

local flyToggle = MainTab:CreateToggle({Name="เปิด/ปิด การบิน", CurrentValue=false, Flag="FlyToggle", Callback=function(val) if val then startFlying() else stopFlying() end end})
local flySlider = MainTab:CreateSlider({Name="ความเร็วบิน", Range={1,1000}, Increment=1, Suffix=" Speed", CurrentValue=50, Flag="FlySpeed", Callback=function(val) flySpeed=val end})
local speedToggle = MainTab:CreateToggle({Name="เปิด/ปิด วิ่งเร็ว", CurrentValue=false, Flag="SpeedToggle", Callback=toggleSpeed})
local speedSlider = MainTab:CreateSlider({Name="ความเร็ววิ่ง", Range={1,1000}, Increment=1, Suffix=" Speed", CurrentValue=32, Flag="RunSpeed", Callback=function(val) runSpeed=val if superSpeed then humanoid.WalkSpeed=runSpeed end end})
local noclipToggle = MainTab:CreateToggle({Name="เปิด/ปิด Noclip", CurrentValue=false, Flag="NoclipToggle", Callback=function(val) noclipEnabled=val end})
local infJumpToggle = MainTab:CreateToggle({Name="เปิด/ปิด Infinite Jump", CurrentValue=false, Flag="InfJumpToggle", Callback=function(val) infJumpEnabled=val end})

-- === ลบหมอกถาวร ===
local OriginalFogEnd = game:GetService("Lighting").FogEnd
local OriginalFogStart = game:GetService("Lighting").FogStart
local FogLoopConnection = nil

local ToggleFog = MainTab:CreateToggle({
    Name = "ลบหมอก (ถาวร)",
    CurrentValue = false,
    Flag = "ToggleFog",
    Callback = function(val)
        local Lighting = game:GetService("Lighting")
        if val then
            if OriginalFogEnd == nil then OriginalFogEnd = Lighting.FogEnd end
            if OriginalFogStart == nil then OriginalFogStart = Lighting.FogStart end
            if FogLoopConnection then FogLoopConnection:Disconnect() end
            FogLoopConnection = RS.Heartbeat:Connect(function()
                if not ToggleFog.CurrentValue then return end
                Lighting.FogEnd = 1000
                Lighting.FogStart = 1000
            end)
            Lighting.FogEnd = 1000
            Lighting.FogStart = 1000
            Rayfield:Notify({Title = "ลบหมอก", Content = "หมอกหายถาวร!", Duration = 3})
        else
            if FogLoopConnection then FogLoopConnection:Disconnect() FogLoopConnection = nil end
            Lighting.FogEnd = OriginalFogEnd or 100000
            Lighting.FogStart = OriginalFogStart or 0
            Rayfield:Notify({Title = "ลบหมอก", Content = "หมอกกลับมาแล้ว", Duration = 3})
        end
    end
})

-- รองรับ Load Config
task.spawn(function()
    task.wait(1)
    if ToggleFog.CurrentValue then
        ToggleFog.Callback(true)
    end
end)

-- === แท็บวาป + ลากศพ ===
local friendTab = Window:CreateTab("วาป", 6026568198)

local function getPlayerList()
    local list = {}
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= player then
            table.insert(list, p.DisplayName.." ("..p.Name..")")
        end
    end
    return list
end

local friendDropdown = friendTab:CreateDropdown({
    Name = "เลือกเพื่อน",
    Options = getPlayerList(),
    CurrentOption = {},
    Flag = "FriendSelect"
})

-- ปุ่มวาปไปหาเพื่อน
friendTab:CreateButton({
    Name = "วาปไปหาเพื่อน",
    Callback = function()
        local selected = friendDropdown.CurrentOption[1]
        if not selected or selected == "" then
            Rayfield:Notify({Title = "Error", Content = "กรุณาเลือกเพื่อนก่อน!", Duration = 3})
            return
        end
        local friendName = selected:match("%((.-)%)") or selected
        char = player.Character or player.CharacterAdded:Wait()
        hrp = char:WaitForChild("HumanoidRootPart")
        local targetPlayer = Players:FindFirstChild(friendName)
        if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
            hrp.CFrame = targetPlayer.Character.HumanoidRootPart.CFrame + Vector3.new(0,3,0)
            Rayfield:Notify({Title = "Teleport สำเร็จ", Content = "ไปหา "..friendName, Duration = 3})
        else
            Rayfield:Notify({Title = "ไม่พบเป้าหมาย", Content = "เพื่อนไม่ออนไลน์", Duration = 3})
        end
    end
})

-- === ลากศพเฉพาะชื่อ ===
local DragOffset = 5
local DragDelay = 0.2

friendTab:CreateSlider({
    Name = "ระยะห่างลากศพ (studs)",
    Range = {1, 15},
    Increment = 1,
    CurrentValue = 5,
    Flag = "DragOffset",
    Callback = function(val) DragOffset = val end
})

friendTab:CreateSlider({
    Name = "ดีเลย์ลาก (วินาที)",
    Range = {0.05, 1},
    Increment = 0.05,
    CurrentValue = 0.2,
    Flag = "DragDelay",
    Callback = function(val) DragDelay = val end
})

friendTab:CreateButton({
    Name = "ลากศพตามชื่อ",
    Callback = function()
        local selected = friendDropdown.CurrentOption[1]
        if not selected then
            Rayfield:Notify({Title = "ผิดพลาด", Content = "กรุณาเลือกชื่อก่อน!", Duration = 3})
            return
        end
        local displayName = selected:match("^(.+) %(") or selected

        char = player.Character or player.CharacterAdded:Wait()
        hrp = char:WaitForChild("HumanoidRootPart")

        local itemsFolder = Workspace:WaitForChild("Characters", 10)
        local remoteEvents = ReplicatedStorage:WaitForChild("RemoteEvents", 10)
        if not itemsFolder or not remoteEvents then
            Rayfield:Notify({Title = "ผิดพลาด", Content = "ไม่พบ Characters หรือ RemoteEvents", Duration = 5})
            return
        end

        local startDragging = remoteEvents:WaitForChild("RequestStartDraggingItem", 5)
        local stopDragging = remoteEvents:WaitForChild("StopDraggingItem", 5)
        if not startDragging or not stopDragging then
            Rayfield:Notify({Title = "ผิดพลาด", Content = "ไม่พบ RemoteEvent ลากศพ", Duration = 5})
            return
        end

        local targetName = displayName .. " Body"
        local bodies = {}
        for _, obj in pairs(itemsFolder:GetChildren()) do
            if obj.Name == targetName then
                table.insert(bodies, obj)
            end
        end

        if #bodies == 0 then
            Rayfield:Notify({Title = "ไม่พบศพ", Content = "ไม่มีศพชื่อ \""..targetName.."\"", Duration = 4})
            return
        end

        Rayfield:Notify({Title = "กำลังลากศพ", Content = "พบ "..#bodies.." ตัว", Duration = 3})

        task.spawn(function()
            for i, body in ipairs(bodies) do
                local clone = cloneref and cloneref(body) or body
                startDragging:FireServer(clone)
                task.wait(0.02)
                if body.PrimaryPart then
                    body:PivotTo(hrp.CFrame * CFrame.new(0, 0, -DragOffset))
                end
                task.wait(0.05)
                stopDragging:FireServer(clone)
                task.wait(DragDelay)
            end
            Rayfield:Notify({Title = "สำเร็จ!", Content = "ลากศพทั้งหมด "..#bodies.." ตัว!", Duration = 4})
        end)
    end
})

friendTab:CreateButton({
    Name = "รีเฟรชรายชื่อ",
    Callback = function()
        friendDropdown:Set(getPlayerList())
        Rayfield:Notify({Title = "อัปเดตแล้ว", Content = "รีเฟรชรายชื่อสำเร็จ", Duration = 3})
    end
})

-- อัปเดต Dropdown
Players.PlayerAdded:Connect(function() friendDropdown:Set(getPlayerList()) end)
Players.PlayerRemoving:Connect(function() friendDropdown:Set(getPlayerList()) end)

-- === แท็บสคริปต์เพิ่มเติม ===
local extraTab = Window:CreateTab("God Mode+ดึงของ", 6031280882)
extraTab:CreateButton({Name = "GOD MODE", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/livezalaeveryday/99-Night-Forest/refs/heads/main/godmode"))() end})
extraTab:CreateButton({Name = "เติมไฟ", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/livezalaeveryday/99-Night-Forest/refs/heads/main/getfire"))() end})
extraTab:CreateButton({Name = "ดึงยาเข้าตัว", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/livezalaeveryday/99-Night-Forest/refs/heads/main/getbandage"))() end})
extraTab:CreateButton({Name = "ดึงเหล็กเข้าตัว", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/livezalaeveryday/99-Night-Forest/refs/heads/main/getiron"))() end})
extraTab:CreateButton({Name = "Script SomTank", Callback = function() loadstring(game:HttpGet('https://raw.githubusercontent.com/MQPS7/99-Night-in-the-Forset/refs/heads/main/99v3'))() end})
extraTab:CreateButton({Name = "Script Foxname Hub", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/caomod2077/Script/refs/heads/main/FoxnameHub.lua"))() end})

-- === แท็บอัพเดต & เครดิต ===
local updateTab = Window:CreateTab("รายการอัพเดต", 6034989579)
updateTab:CreateLabel("v1.5 - เพิ่ม ลบหมอกถาวร + ลากศพเฉพาะชื่อ")
updateTab:CreateLabel("v1.4 - แก้บั๊ก Respawn, Noclip, Fly")
updateTab:CreateLabel("v1.3.6 - แก้บั๊กเต็มรูปแบบ")

local creditTab2 = Window:CreateTab("เครดิต", 6034989579)
creditTab2:CreateLabel("owner by livezala")
creditTab2:CreateLabel("original script by dion_ktl")
creditTab2:CreateLabel("พัฒนาต่อโดย thomas (โทมัส)")
creditTab2:CreateLabel("อัพเดต 31/10/2025")
creditTab2:CreateLabel("Discord: dSyCsRpU62")

-- === เคาท์ดาวน์ปีใหม่ ===
local newYearTab = Window:CreateTab("เคาท์ดาวน์ปีใหม่", 6034979821)
local countdownLabel = newYearTab:CreateLabel("กำลังโหลดเคาท์ดาวน์...")
local targetTime = os.time({year=2026, month=1, day=1, hour=0, min=0, sec=0})
local countdownConnection = RS.RenderStepped:Connect(function()
    local diff = targetTime - os.time()
    if diff <= 0 then
        countdownLabel:Set("Happy New Year!")
        countdownConnection:Disconnect()
        return
    end
    local d = math.floor(diff / 86400)
    local h = math.floor((diff % 86400) / 3600)
    local m = math.floor((diff % 3600) / 60)
    local s = diff % 60
    countdownLabel:Set(string.format("%02d:%02d:%02d:%02d", d, h, m, s))
end)

-- === ลูปหลัก ===
RS.RenderStepped:Connect(function()
    if flying and vv and gyro and hrp and humanoid then
        local cam = workspace.CurrentCamera
        if not cam then return end
        local forward = Vector3.new(cam.CFrame.LookVector.X, 0, cam.CFrame.LookVector.Z).Unit
        local right = Vector3.new(cam.CFrame.RightVector.X, 0, cam.CFrame.RightVector.Z).Unit
        local moveVec = Vector3.zero
        if UIS:IsKeyDown(Enum.KeyCode.W) then moveVec += forward end
        if UIS:IsKeyDown(Enum.KeyCode.S) then moveVec -= forward end
        if UIS:IsKeyDown(Enum.KeyCode.A) then moveVec -= right end
        if UIS:IsKeyDown(Enum.KeyCode.D) then moveVec += right end
        if UIS:IsKeyDown(Enum.KeyCode.Space) then moveVec += Vector3.new(0,1,0) end
        if UIS:IsKeyDown(Enum.KeyCode.LeftShift) then moveVec += Vector3.new(0,-1,0) end
        if moveVec.Magnitude > 0 then vv.Velocity = moveVec.Unit * flySpeed else vv.Velocity = Vector3.zero end
        if moveVec.X ~= 0 or moveVec.Z ~= 0 then
            gyro.CFrame = CFrame.new(hrp.Position, hrp.Position + Vector3.new(moveVec.X, 0, moveVec.Z))
        end
    end
end)

RS.Stepped:Connect(function()
    if noclipEnabled and char then
        for _,part in pairs(char:GetDescendants()) do
            if part:IsA("BasePart") then part.CanCollide = false end
        end
    end
end)

UIS.JumpRequest:Connect(function()
    if infJumpEnabled and humanoid then
        humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

-- รีเซ็ตเมื่อ respawn
player.CharacterAdded:Connect(function(c)
    char = c
    hrp = c:WaitForChild("HumanoidRootPart")
    humanoid = c:WaitForChild("Humanoid")
    stopFlying()
    toggleSpeed(false)
    noclipEnabled = false
    infJumpEnabled = false
    Rayfield:LoadConfiguration()
end)

Rayfield:Notify({Title="โหลดสำเร็จ!", Content="พร้อมลุย ไลฟ์สาระ ไปวันๆ!", Duration=4, Image=6026568198})
