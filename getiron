-- ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡πÇ‡∏≠‡∏ô‡πÑ‡∏ß‡πÇ‡∏´‡∏°‡∏î: ‡∏•‡∏≤‡∏Å‡∏•‡∏á‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î + ‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°
local Players = cloneref(game:GetService("Players"))
local ReplicatedStorage = cloneref(game:GetService("ReplicatedStorage"))
local Workspace = cloneref(game:GetService("Workspace"))

-- ====== ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ ======
-- ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà: { ["‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°"] = ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ }
local itemLimit = {
    ["Log"] = 10,
    ["Bolt"] = 10,
    ["Sheet Metal"] = 10,
    ["UFO Junk"] = 10,
    ["UFO Component"] = 10,
    ["Broken Fan"] = 10,
    ["Old Radio"] = 10,
    ["Broken Microwave"] = 10,
    ["Tyre"] = 10,
    ["Metal Chair"] = 10,
    ["Old Car Engine"] = 10,
    ["Washing Machine"] = 10,
    ["UFO Scrap"] = 10
}

local TARGET_POSITION = Vector3.new(20.953277587890625, 1.200000286102295 + 300, -5.237123012542725)
local delayBetweenItems = 0.3

-- ====== ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£ ======
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")

-- ====== ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå/‡∏£‡∏µ‡πÇ‡∏°‡∏ó ======
local itemsFolder = Workspace:WaitForChild("Items")
local remoteEvents = ReplicatedStorage:WaitForChild("RemoteEvents")
local startDragging = remoteEvents:WaitForChild("RequestStartDraggingItem")
local stopDragging = remoteEvents:WaitForChild("StopDraggingItem")

-- ====== ‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏•‡∏≤‡∏Å‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ======
local draggedCount = {}
for name, _ in pairs(itemLimit) do
    draggedCount[name] = 0
end

-- ====== ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏¢‡∏±‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡∏ô‡∏µ‡πâ‡πÑ‡∏´‡∏° ======
local function canDragMore(itemName)
    local limit = itemLimit[itemName]
    if not limit then return false end
    return draggedCount[itemName] < limit
end

-- ====== ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏≤‡∏Å ======
local function dragItemToPosition(itemToDrag, position)
    local clonedItem = cloneref(itemToDrag)
    startDragging:FireServer(clonedItem)
    
    task.spawn(function()
        task.wait(0.02) -- ‡∏£‡∏≠‡πÉ‡∏´‡πâ server ‡∏£‡∏±‡∏ö dragging ‡∏Å‡πà‡∏≠‡∏ô
        if clonedItem:IsA("BasePart") then
            clonedItem.CFrame = CFrame.new(position)
        elseif clonedItem:IsA("Model") and clonedItem.PrimaryPart then
            clonedItem:SetPrimaryPartCFrame(CFrame.new(position))
        end
    end)
    
    task.wait(0.05)
    stopDragging:FireServer(clonedItem)
end

-- ====== ‡∏•‡∏≤‡∏Å‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î ======
local function dragLimitedItemsToTarget()
    print("üéØ ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:", TARGET_POSITION)
    
    local children = itemsFolder:GetChildren()
    local itemsToDrag = {}
    
    -- ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÑ‡∏≠‡πÄ‡∏ó‡πá‡∏°‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
    for _, item in ipairs(children) do
        if canDragMore(item.Name) then
            table.insert(itemsToDrag, item)
        end
    end
    
    print("üîç ‡∏û‡∏ö " .. #itemsToDrag .. " ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏≤‡∏Å (‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î)")
    
    -- ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (‡πÉ‡∏Å‡∏•‡πâ‡∏Å‡πà‡∏≠‡∏ô)
    table.sort(itemsToDrag, function(a, b)
        local distA = (a:GetPivot().Position - TARGET_POSITION).Magnitude
        local distB = (b:GetPivot().Position - TARGET_POSITION).Magnitude
        return distA < distB
    end)
    
    local totalDragged = 0
    for i, item in ipairs(itemsToDrag) do
        if canDragMore(item.Name) then
            print(string.format("‡∏•‡∏≤‡∏Å‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏ó‡∏µ‡πà %d: %s (%d/%d)", i, item.Name, draggedCount[item.Name] + 1, itemLimit[item.Name]))
            dragItemToPosition(item, TARGET_POSITION)
            draggedCount[item.Name] = draggedCount[item.Name] + 1
            totalDragged = totalDragged + 1
            task.wait(delayBetweenItems)
        end
    end
    
    -- ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
    print("üéâ ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß! ‡∏•‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î " .. totalDragged .. " ‡∏ä‡∏¥‡πâ‡∏ô")
    print("üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•:")
    for name, limit in pairs(itemLimit) do
        local count = draggedCount[name]
        local status = count >= limit and "‚úÖ" or "‚è≥"
        print(string.format("  %s %s: %d/%d", status, name, count, limit))
    end
end

-- ‡∏£‡∏±‡∏ô‡πÄ‡∏•‡∏¢!
dragLimitedItemsToTarget()
