local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- สร้าง Window
local Window = Rayfield:CreateWindow({
   Name = "ไลฟ์สาระ ไปวันๆ v1.5 (God Mode)",
   Icon = 0,
   LoadingTitle = "ยินดีต้อนรับ Power Panel v1 สคริปต์ของไลฟ์สาระไปวันๆ",
   LoadingSubtitle = "power panel team",
   ShowText = "Rayfield",
   Theme = "Amethyst",
   ToggleUIKeybind = "K",
   DisableRayfieldPrompts = true,
   DisableBuildWarnings = true,
   ConfigurationSaving = {
      Enabled = true,
      FolderName = nil,
      FileName = "Big Hub"
   },
   Discord = {
      Enabled = false,
      Invite = "noinvitelink",
      RememberJoins = true
   },
   KeySystem = false,
   KeySettings = {
      Title = "ระบบคีย์",
      Subtitle = "ไปหาซื้อคีย์มาใส่",
      Note = "No method of obtaining the key is provided",
      FileName = "Key",
      SaveKey = true,
      GrabKeyFromSite = false,
      Key = {"Hello"}
   }
})

-- === ปุ่มมือถือ แยก ScreenGui (ปลอดภัยกว่า) ===
local player = game.Players.LocalPlayer
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "RayfieldToggleGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local MobileButton = Instance.new("TextButton")
MobileButton.Size = UDim2.new(0, 100, 0, 50)
MobileButton.Position = UDim2.new(0, 10, 0, 10)
MobileButton.Text = "Rayfield"
MobileButton.BackgroundColor3 = Color3.fromRGB(100, 50, 200)
MobileButton.TextColor3 = Color3.new(1,1,1)
MobileButton.Font = Enum.Font.GothamBold
MobileButton.TextScaled = true
MobileButton.Parent = screenGui

MobileButton.MouseButton1Click:Connect(function()
    Window:Toggle()
end)

-- === ตัวแปรระบบ ===
local Players = game:GetService("Players")
local RS = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local player = Players.LocalPlayer
local char, hrp, humanoid

-- ตัวแปรฟังก์ชัน
local flying = false
local vv, gyro
local flySpeed = 50
local superSpeed = false
local runSpeed = 32
local noclipEnabled = false
local infJumpEnabled = false

-- === ฟังก์ชันอัปเดตตัวละคร ===
local function updateCharacterReferences()
    char = player.Character
    if not char then return end
    hrp = char:FindFirstChild("HumanoidRootPart")
    humanoid = char:FindFirstChild("Humanoid")
end

-- === ตั้งค่าตัวละครครั้งแรก ===
player.CharacterAdded:Connect(function(c)
    char = c
    updateCharacterReferences()
    
    -- รอโหลดให้แน่นอน
    task.delay(0.1, function()
        if c:FindFirstChild("HumanoidRootPart") and c:FindFirstChild("Humanoid") then
            updateCharacterReferences()
        end
    end)

    -- รีเซ็ตสถานะ
    stopFlying()
    toggleSpeed(false)
    noclipEnabled = false
    infJumpEnabled = false
    Rayfield:LoadConfiguration()
end)

player.CharacterRemoving:Connect(function()
    stopFlying()
end)

-- เรียกครั้งแรก
updateCharacterReferences()

-- === ฟังก์ชันบิน ===
local function startFlying()
    if flying or not hrp or not humanoid then return end
    flying = true
    humanoid.PlatformStand = true

    vv = Instance.new("BodyVelocity")
    vv.MaxForce = Vector3.new(1e5, 1e5, 1e5)
    vv.P = 1250
    vv.Velocity = Vector3.zero
    vv.Parent = hrp

    gyro = Instance.new("BodyGyro")
    gyro.MaxTorque = Vector3.new(4e5, 4e5, 4e5)
    gyro.P = 3000
    gyro.CFrame = hrp.CFrame
    gyro.Parent = hrp

    Rayfield:Notify({
        Title = "โหมดบินเปิด!",
        Content = "ใช้ W,A,S,D,Space,Ctrl เพื่อควบคุม",
        Duration = 3,
        Image = 6026568198
    })
end

local function stopFlying()
    if not flying then return end
    flying = false
    if vv and vv.Parent then vv:Destroy() end
    if gyro and gyro.Parent then gyro:Destroy() end
    vv, gyro = nil, nil
    if humanoid then humanoid.PlatformStand = false end

    Rayfield:Notify({
        Title = "โหมดบินปิด",
        Content = "ลงจอดเรียบร้อย",
        Duration = 3,
        Image = 6026568198
    })
end

-- === ฟังก์ชันวิ่งเร็ว ===
local function toggleSpeed(on)
    superSpeed = on
    if humanoid then
        humanoid.WalkSpeed = superSpeed and runSpeed or 16
    end
    Rayfield:Notify({
        Title = superSpeed and "วิ่งเร็วเปิด" or "วิ่งเร็วปิด",
        Content = superSpeed and "วิ่งเร็วสุดขีด!" or "กลับสู่ความเร็วปกติ",
        Duration = 3,
        Image = 6023426921
    })
end

-- === แท็บตัวละคร ===
local MainTab = Window:CreateTab("ตัวละคร", 6026568198)

local flyToggle = MainTab:CreateToggle({
    Name = "เปิด/ปิด การบิน",
    CurrentValue = false,
    Flag = "FlyToggle",
    Callback = function(val)
        if val then startFlying() else stopFlying() end
    end
})

local flySlider = MainTab:CreateSlider({
    Name = "ความเร็วบิน",
    Range = {1, 1000},
    Increment = 1,
    Suffix = " Speed",
    CurrentValue = 50,
    Flag = "FlySpeed",
    Callback = function(val)
        flySpeed = val
        Rayfield:Notify({
            Title = "ปรับความเร็วบิน",
            Content = "ตั้งความเร็วบินเป็น " .. val,
            Duration = 2,
            Image = 6026568198
        })
    end
})

local speedToggle = MainTab:CreateToggle({
    Name = "เปิด/ปิด วิ่งเร็ว",
    CurrentValue = false,
    Flag = "SpeedToggle",
    Callback = toggleSpeed
})

local speedSlider = MainTab:CreateSlider({
    Name = "ความเร็ววิ่ง",
    Range = {1, 1000},
    Increment = 1,
    Suffix = " Speed",
    CurrentValue = 32,
    Flag = "RunSpeed",
    Callback = function(val)
        runSpeed = val
        if superSpeed and humanoid then humanoid.WalkSpeed = runSpeed end
        Rayfield:Notify({
            Title = "ปรับความเร็ววิ่ง",
            Content = "ตั้งความเร็ววิ่งเป็น " .. val,
            Duration = 2,
            Image = 6023426921
        })
    end
})

local noclipToggle = MainTab:CreateToggle({
    Name = "เปิด/ปิด Noclip",
    CurrentValue = false,
    Flag = "NoclipToggle",
    Callback = function(val)
        noclipEnabled = val
        Rayfield:Notify({
            Title = val and "Noclip เปิด" or "Noclip ปิด",
            Content = val and "เดินทะลุวัตถุได้!" or "กลับปกติ",
            Duration = 3,
            Image = 6026568198
        })
    end
})

local infJumpToggle = MainTab:CreateToggle({
    Name = "เปิด/ปิด Infinite Jump",
    CurrentValue = false,
    Flag = "InfJumpToggle",
    Callback = function(val)
        infJumpEnabled = val
        Rayfield:Notify({
            Title = val and "Infinite Jump เปิด" or "Infinite Jump ปิด",
            Content = val and "กระโดดไม่จำกัด!" or "กลับสู่ปกติ",
            Duration = 3,
            Image = 6026568198
        })
    end
})

-- === แท็บวาป ===
local friendTab = Window:CreateTab("วาป", 6026568198)

local function getPlayerList()
    local list = {}
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= player then
            table.insert(list, p.DisplayName .. " (" .. p.Name .. ")")
        end
    end
    return list
end

local friendDropdown = friendTab:CreateDropdown({
    Name = "เลือกเพื่อน",
    Options = getPlayerList(),
    CurrentOption = {""},
    Flag = "FriendSelect"
})

friendTab:CreateButton({
    Name = "วาปไปหาเพื่อน",
    Callback = function()
        local selected = friendDropdown.CurrentOption[1]
        if not selected or selected == "" then
            Rayfield:Notify({
                Title = "Error",
                Content = "กรุณาเลือกเพื่อนก่อน!",
                Duration = 3,
                Image = 6026568198
            })
            return
        end

        local friendName = selected:match("%((.-)%)") or selected
        updateCharacterReferences()

        if not hrp or not hrp.Parent then
            Rayfield:Notify({
                Title = "Error",
                Content = "ตัวละครยังไม่โหลด!",
                Duration = 3,
                Image = 6026568198
            })
            return
        end

        local targetPlayer = Players:FindFirstChild(friendName)
        local targetCFrame = nil

        if targetPlayer and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
            targetCFrame = targetPlayer.Character.HumanoidRootPart.CFrame
        end

        if targetCFrame then
            hrp.CFrame = targetCFrame + Vector3.new(0, 3, 0)
            Rayfield:Notify({
                Title = "Teleport สำเร็จ",
                Content = "คุณได้ไปหา " .. friendName,
                Duration = 3,
                Image = 6026568198
            })
        else
            Rayfield:Notify({
                Title = "ไม่พบเป้าหมาย",
                Content = "เพื่อนไม่ออนไลน์",
                Duration = 3,
                Image = 6026568198
            })
        end
    end
})

friendTab:CreateButton({
    Name = "รีเฟรชรายชื่อ",
    Callback = function()
        friendDropdown:Set(getPlayerList())
        Rayfield:Notify({
            Title = "รายชื่ออัปเดตแล้ว",
            Content = "โหลดรายชื่อผู้เล่นใหม่สำเร็จ!",
            Duration = 3,
            Image = 6026568198
        })
    end
})

-- อัปเดต Dropdown อัตโนมัติ
Players.PlayerAdded:Connect(function()
    friendDropdown:Set(getPlayerList())
end)

Players.PlayerRemoving:Connect(function()
    friendDropdown:Set(getPlayerList())
end)

-- === แท็บสคริปต์เพิ่มเติม ===
local extraTab = Window:CreateTab("99คืนในป่าค่ายอื่น", 6031280882)

extraTab:CreateButton({
    Name = "GOD MODE",
    Callback = function()
        Rayfield:Notify({Title = "กำลังเปิด GOD MODE", Content = "กรุณารอสักครู่", Duration = 3, Image = 6026568198})
        loadstring(game:HttpGet("https://raw.githubusercontent.com/livezalaeveryday/99-Night-Forest/refs/heads/main/godmode"))()
    end
})

extraTab:CreateButton({
    Name = "รัน SomTank",
    Callback = function()
        Rayfield:Notify({Title = "กำลังโหลด SomTank...", Content = "กรุณารอสักครู่", Duration = 3, Image = 6026568198})
        loadstring(game:HttpGet('https://raw.githubusercontent.com/MQPS7/99-Night-in-the-Forset/refs/heads/main/99v3'))()
    end
})

extraTab:CreateButton({
    Name = "รัน Foxname Hub",
    Callback = function()
        Rayfield:Notify({Title = "กำลังโหลด Foxname...", Content = "กรุณารอสักครู่", Duration = 3, Image = 6026568198})
        loadstring(game:HttpGet("https://raw.githubusercontent.com/caomod2077/Script/refs/heads/main/FoxnameHub.lua"))()
    end
})

-- === แท็บอัพเดต ===
local updateTab = Window:CreateTab("รายการอัพเดต", 6034989579)
updateTab:CreateLabel("version 1.3.3 (+)แท็บรายการอัพเดต แท็บสคริปต์เพิ่มเติม แท็บวาป แก้ไขให้วาปใช้ได้กับ displayname")
updateTab:CreateLabel("version 1.3.4 ไม่ประสงค์บอกอัพเดต")
updateTab:CreateLabel("version 1.3.5 (=)เปลี่ยนวาปให้เป็นไม่ต้องพิมพ์แค่เลือกแล้วกดก็สามารถเลือกวาปได้ by thomas")
updateTab:CreateLabel("version 1.3.6 แก้บั๊ก Respawn, Noclip, Fly ค้าง")

-- === แท็บเครดิต ===
local creditTab2 = Window:CreateTab("เครดิต", 6034989579)
creditTab2:CreateLabel("เครดิต")
creditTab2:CreateLabel("owner by livezala")
creditTab2:CreateLabel("original script by dion_ktl")
creditTab2:CreateLabel("นำมาต่อยอด by thomas (โทมัส)")
creditTab2:CreateLabel("อัพเดต 10/11/2025 10:54 PM")
creditTab2:CreateLabel("version 1.3.6 (แก้บั๊กเต็มรูปแบบ)")
creditTab2:CreateLabel("รับอัพเดต discord: dSyCsRpU62")

-- === เคาท์ดาวน์ปีใหม่ ===
local newYearTab = Window:CreateTab("เคาท์ดาวน์ปีใหม่", 6034979821)
local countdownLabel = newYearTab:CreateLabel("กำลังโหลดเคาท์ดาวน์...")
local targetTime = os.time({year = 2026, month = 1, day = 1, hour = 0, min = 0, sec = 0})

local countdownConnection
countdownConnection = RS.RenderStepped:Connect(function()
    local now = os.time()
    local diff = targetTime - now

    if diff <= 0 then
        countdownLabel:Set("Happy New Year!")
        countdownConnection:Disconnect()
        return
    end

    local days = math.floor(diff / 86400)
    local hours = math.floor((diff % 86400) / 3600)
    local minutes = math.floor((diff % 3600) / 60)
    local seconds = diff % 60

    countdownLabel:Set(string.format("%02d:%02d:%02d:%02d", days, hours, minutes, seconds))
end)

-- === ลูปหลัก ===
RS.RenderStepped:Connect(function()
    if flying and vv and vv.Parent and gyro and gyro.Parent and hrp and humanoid then
        local cam = workspace.CurrentCamera
        if not cam then return end

        local flatForward = Vector3.new(cam.CFrame.LookVector.X, 0, cam.CFrame.LookVector.Z)
        local forward = flatForward.Magnitude > 0 and flatForward.Unit or Vector3.zero
        local right = Vector3.new(cam.CFrame.RightVector.X, 0, cam.CFrame.RightVector.Z)
        if right.Magnitude > 0 then right = right.Unit end

        local moveVec = Vector3.zero
        if UIS:IsKeyDown(Enum.KeyCode.W) then moveVec += Vector3.new(0, 0, 1) end
        if UIS:IsKeyDown(Enum.KeyCode.S) then moveVec += Vector3.new(0, 0, -1) end
        if UIS:IsKeyDown(Enum.KeyCode.A) then moveVec += Vector3.new(-1, 0, 0) end
        if UIS:IsKeyDown(Enum.KeyCode.D) then moveVec += Vector3.new(1, 0, 0) end
        if UIS:IsKeyDown(Enum.KeyCode.Space) then moveVec += Vector3.new(0, 1, 0) end
        if UIS:IsKeyDown(Enum.KeyCode.LeftControl) then moveVec += Vector3.new(0, -1, 0) end

        local desired = forward * moveVec.Z + right * moveVec.X + Vector3.new(0, moveVec.Y, 0)
        if desired.Magnitude > 0 then desired = desired.Unit * flySpeed end
        vv.Velocity = desired

        if desired.Magnitude > 1 then
            local flatDir = Vector3.new(desired.X, 0, desired.Z)
            if flatDir.Magnitude > 0 then
                gyro.CFrame = CFrame.new(hrp.Position, hrp.Position + flatDir)
            end
        end
    end
end)

RS.Stepped:Connect(function()
    if noclipEnabled and char then
        for _, part in pairs(char:GetDescendants()) do
            if part:IsA("BasePart") then
                part.CanCollide = false
            end
        end
    end
end)

UIS.JumpRequest:Connect(function()
    if infJumpEnabled and humanoid then
        humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

-- === แจ้งเตือนโหลดสำเร็จ ===
Rayfield:Notify({
    Title = "โปรโหลดสำเร็จ!",
    Content = "พร้อมผจญภัยกับ ไลฟ์สาระ ไปวันๆ แล้ว!",
    Duration = 4,
    Image = 6026568198
})
