local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- สร้าง Window
local Window = Rayfield:CreateWindow({
   Name = "ไลฟ์สาระ ไปวันๆ v2.0",
   Icon = nil,
   LoadingTitle = "ยินดีต้อนรับ Power Panel v2.0 สคริปต์ของไลฟ์สาระ ไปวันๆ",
   LoadingSubtitle = "power panel team",
   ShowText = "Rayfield",
   Theme = "Bloom",
   ToggleUIKeybind = "K",
   DisableRayfieldPrompts = true,
   DisableBuildWarnings = true,
   ConfigurationSaving = {
      Enabled = true,
      FolderName = nil,
      FileName = "Big Hub"
   },
   Discord = {
      Enabled = false,
      Invite = "noinvitelink",
      RememberJoins = true
   },
   KeySystem = false,
   KeySettings = {
      Title = "ระบบคีย์",
      Subtitle = "ไปหาซื้อคีย์มาใส่",
      Note = "No method of obtaining the key is provided",
      FileName = "Key",
      SaveKey = true,
      GrabKeyFromSite = false,
      Key = {"Hello"}
   }
})

-- ตัวแปรระบบ
local Players = game:GetService("Players")
local RS = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")
local humanoid = char:WaitForChild("Humanoid")

-- ตัวแปรฟังก์ชัน
local flying = false
local vv, gyro
local flySpeed = 200
local superSpeed = false
local runSpeed = 32
local noclipEnabled = false
local infJumpEnabled = false

-- === ฟังก์ชันบิน ===
local function startFlying()
    if flying then return end
    flying = true
    humanoid.PlatformStand = true
    vv = Instance.new("BodyVelocity")
    vv.MaxForce = Vector3.new(1e5,1e5,1e5)
    vv.P = 1250
    vv.Velocity = Vector3.zero
    vv.Parent = hrp
    gyro = Instance.new("BodyGyro")
    gyro.MaxTorque = Vector3.new(4e5,4e5,4e5)
    gyro.P = 3000
    gyro.CFrame = hrp.CFrame
    gyro.Parent = hrp
    Rayfield:Notify({Title = "โหมดบินเปิด!", Content = "ใช้ W,A,S,D,Space,Ctrl เพื่อควบคุม", Duration = 3, Image = 6026568198})
end

local function stopFlying()
    if not flying then return end
    flying = false
    if vv then vv:Destroy() vv=nil end
    if gyro then gyro:Destroy() gyro=nil end
    humanoid.PlatformStand = false
    Rayfield:Notify({Title = "โหมดบินปิด", Content = "ลงจอดเรียบร้อย", Duration = 3, Image = 6026568198})
end

-- ฟังก์ชันวิ่งเร็ว
local function toggleSpeed(on)
    superSpeed = on
    humanoid.WalkSpeed = superSpeed and runSpeed or 16
    Rayfield:Notify({Title = superSpeed and "วิ่งเร็วเปิด" or "วิ่งเร็วปิด", Content = superSpeed and "วิ่งเร็วสุดขีด!" or "กลับสู่ความเร็วปกติ", Duration = 3, Image = 6023426921})
end

-- === แท็บตัวละคร ===
local MainTab = Window:CreateTab("ใช้บ่อย")
MainTab:CreateButton({Name = "GOD MODE", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/livezalaeveryday/99-Night-Forest/refs/heads/main/godmode"))() end})
MainTab:CreateButton({Name = "หนีกลับบ้าน",Callback = function()local char = player.Character or player.CharacterAdded:Wait()local hrp = char:WaitForChild("HumanoidRootPart")hrp.CFrame = CFrame.new(12.079488, 48.5, 3.2662038, 0, 0, 1, 0, 1, 0, -1, 0, 0)Rayfield:Notify({Title="วาปด่วน!", Content="ถึงแล้ว", Duration=2, Image=13014647359})end})
MainTab:CreateButton({Name = "เติมไฟ", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/livezalaeveryday/99-Night-Forest/refs/heads/main/getfire"))() end})
MainTab:CreateButton({Name = "ดึงยาเข้าตัว", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/livezalaeveryday/99-Night-Forest/refs/heads/main/getbandage"))() end})
MainTab:CreateButton({Name = "ดึงเหล็กเข้าตัว", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/livezalaeveryday/99-Night-Forest/refs/heads/main/getiron"))() end})
local flyToggle = MainTab:CreateToggle({Name="เปิด/ปิด การบิน", CurrentValue=false, Flag="FlyToggle", Callback=function(val) if val then startFlying() else stopFlying() end end})
local flySlider = MainTab:CreateSlider({Name="ความเร็วบิน", Range={1,200}, Increment=200, Suffix=" Speed", CurrentValue=200, Flag="FlySpeed", Callback=function(val) flySpeed=val end})

-- === แท็บวาป + ลากศพ (เวอร์ชันแยกหน้าที่เรียบร้อย) ===
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local player = Players.LocalPlayer

-- สร้างแท็บ
local friendTab = Window:CreateTab("วาป")

-- ===== Helpers =====
local function getPlayerList()
    local list = {}
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= player then
            table.insert(list, string.format("%s (%s)", p.DisplayName, p.Name))
        end
    end
    return list
end

-- ดึงศพทั้งหมดที่ลงท้ายชื่อด้วย " Body" จากโฟลเดอร์ Characters
local function getAllBodies()
    local folder = Workspace:FindFirstChild("Characters")
    if not folder then return {} end
    local bodies = {}
    for _, obj in ipairs(folder:GetChildren()) do
        if typeof(obj) == "Instance" and typeof(obj.Name) == "string" then
            if obj.Name:sub(-5) == " Body" then
                table.insert(bodies, obj)
            end
        end
    end
    return bodies
end

-- หา BasePart ใดๆ ในโมเดล (กันกรณีไม่มี PrimaryPart)
local function findAnyBasePart(model)
    if not model or not model:IsA("Model") then return nil end
    if model.PrimaryPart then return model.PrimaryPart end
    for _, d in ipairs(model:GetDescendants()) do
        if d:IsA("BasePart") then
            return d
        end
    end
    return nil
end

-- ===== UI: Dropdown เพื่อน (ใช้เฉพาะ “วาปไปหาเพื่อน”) =====
local friendDropdown = friendTab:CreateDropdown({
    Name = "เลือกเพื่อน",
    Options = getPlayerList(),
    CurrentOption = {},
    Flag = "FriendSelect"
})

-- ปุ่มวาปไปหาเพื่อน (ใช้ dropdown)
friendTab:CreateButton({
    Name = "วาปไปหาเพื่อน",
    Callback = function()
        local selected = friendDropdown.CurrentOption[1]
        if not selected or selected == "" then
            Rayfield:Notify({Title = "Error", Content = "กรุณาเลือกเพื่อนก่อน!", Duration = 3})
            return
        end

        local friendName = selected:match("%((.-)%)") or selected
        local char = player.Character or player.CharacterAdded:Wait()
        local hrp = char:WaitForChild("HumanoidRootPart")

        local targetPlayer = Players:FindFirstChild(friendName)
        if targetPlayer and targetPlayer.Character then
            local thrp = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
            if thrp then
                hrp.CFrame = thrp.CFrame + Vector3.new(0, 3, 0)
                Rayfield:Notify({Title = "Teleport สำเร็จ", Content = "ไปหา "..friendName, Duration = 3})
                return
            end
        end
        Rayfield:Notify({Title = "ไม่พบเป้าหมาย", Content = "เพื่อนไม่ออนไลน์/ไม่มี HRP", Duration = 3})
    end
})

-- ===== ตัวปรับค่า ลากศพ =====
local DragOffset = 5
local DragDelay = 0.2

friendTab:CreateSlider({
    Name = "ระยะห่างลากศพ (studs)",
    Range = {1, 15},
    Increment = 1,
    CurrentValue = DragOffset,
    Flag = "DragOffset",
    Callback = function(val) DragOffset = val end
})

friendTab:CreateSlider({
    Name = "ดีเลย์ลาก (วินาที)",
    Range = {0.05, 1},
    Increment = 0.05,
    CurrentValue = DragDelay,
    Flag = "DragDelay",
    Callback = function(val) DragDelay = val end
})

-- ===== ปุ่ม “ลากศพทั้งหมด” (ไม่ใช้ dropdown) =====
friendTab:CreateButton({
    Name = "ลากศพทั้งหมด (ไม่ต้องเลือกชื่อ)",
    Callback = function()
        -- เตรียมตัวเรา
        local char = player.Character or player.CharacterAdded:Wait()
        local hrp = char:WaitForChild("HumanoidRootPart")

        -- เตรียม RemoteEvents
        local remoteEvents = ReplicatedStorage:FindFirstChild("RemoteEvents")
        local startDragging = remoteEvents and remoteEvents:FindFirstChild("RequestStartDraggingItem")
        local stopDragging  = remoteEvents and remoteEvents:FindFirstChild("StopDraggingItem")

        if not (startDragging and stopDragging) then
            Rayfield:Notify({Title = "ผิดพลาด", Content = "ไม่พบ RemoteEvent ลากศพ", Duration = 5})
            return
        end

        -- หา “ศพทั้งหมด”
        local bodies = getAllBodies()
        if #bodies == 0 then
            Rayfield:Notify({Title = "ไม่พบศพ", Content = "ตอนนี้ยังไม่มีใครตาย", Duration = 4})
            return
        end

        Rayfield:Notify({Title = "กำลังลากศพ", Content = "พบ "..#bodies.." ตัว", Duration = 3})

        task.spawn(function()
            for _, body in ipairs(bodies) do
                -- กันกรณีออบเจ็กต์หายระหว่างทาง
                if body and body.Parent then
                    local inst = (typeof(cloneref) == "function") and cloneref(body) or body
                    startDragging:FireServer(inst)
                    task.wait(0.02)

                    -- เลือกพาร์ทอ้างอิงเพื่อวางให้ใกล้ตัวเรา
                    local refPart = findAnyBasePart(body)
                    if refPart then
                        -- ใช้ PivotTo ให้ทั้งโมเดลเลื่อนมาหน้าเรา
                        body:PivotTo(hrp.CFrame * CFrame.new(0, 0, -DragOffset))
                    end

                    task.wait(0.05)
                    stopDragging:FireServer(inst)
                    task.wait(DragDelay)
                end
            end

            Rayfield:Notify({Title = "สำเร็จ!", Content = "ลากศพทั้งหมด "..#bodies.." ตัว!", Duration = 4})
        end)
    end
})

-- ปุ่มรีเฟรชรายชื่อ (มีผลเฉพาะ dropdown วาปเพื่อน)
friendTab:CreateButton({
    Name = "รีเฟรชรายชื่อ",
    Callback = function()
        friendDropdown:Set(getPlayerList())
        Rayfield:Notify({Title = "อัปเดตแล้ว", Content = "รีเฟรชรายชื่อสำเร็จ", Duration = 3})
    end
})

-- อัปเดต Dropdown อัตโนมัติ เมื่อมีคนเข้า/ออก (เฉพาะวาปเพื่อน)
Players.PlayerAdded:Connect(function()
    friendDropdown:Set(getPlayerList())
end)
Players.PlayerRemoving:Connect(function()
    friendDropdown:Set(getPlayerList())
end)

-- === แท็บใหม่: วาปสถานที่ ===
local tpTab = Window:CreateTab("วาปไปที่ต่างๆ")

-- ตารางพิกัด (key = ชื่อในโค้ด, value = พิกัด + ชื่อปุ่มสวย ๆ)
local Locations = {
    Terrain     = { CFrame = CFrame.new(12.079488, 48.5, 3.2662038, 0, 0, 1, 0, 1, 0, -1, 0, 0),       Display = "แคมป์ไฟ (จุดเกิด)" },
    -- เพิ่มกี่ที่ก็ได้ตรงนี้
}

-- ฟังก์ชันวาป (ใช้ซ้ำทุกปุ่ม)
local function teleportTo(data)
    local char = player.Character or player.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")
    hrp.CFrame = data.CFrame
    Rayfield:Notify({
        Title = "วาปสำเร็จ!",
        Content = "ไป "..data.Display.." แล้ว",
        Duration = 3,
        Image = 13014647359
    })
end

-- === สร้างปุ่มอัตโนมัติจากตาราง Locations (แก้จุดผิดพลาดตรงนี้) ===
for key, data in pairs(Locations) do
    tpTab:CreateButton({
        Name = data.Display,
        Callback = function()
            teleportTo(data)
        end
    })
end -- <<< อย่าลืม end ตรงนี้!!!

-- === แท็บสคริปต์เพิ่มเติม ===
local extraTab = Window:CreateTab("Script ค่ายอื่นๆ")
extraTab:CreateButton({Name = "Script SomTank", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/MQPS7/99-Night-in-the-Forset/refs/heads/main/99v5"))() end})
extraTab:CreateButton({Name = "Script Foxname Hub", Callback = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/caomod2077/Script/refs/heads/main/FoxnameHub.lua"))() end})

-- === แท็บอัพเดต ===
local updateTab = Window:CreateTab("รายการอัพเดต")
updateTab:CreateLabel("v1.6 - ลากศพไม่ต้องเลือกชื่อ")
updateTab:CreateLabel("v1.5 - เพิ่ม ลบหมอกถาวร + ลากศพเฉพาะชื่อ")
updateTab:CreateLabel("v1.4 - แก้บั๊ก Respawn, Noclip, Fly")
updateTab:CreateLabel("v1.3.6 - แก้บั๊กเต็มรูปแบบ")

-- === เครดิต ===
local creditTab2 = Window:CreateTab("เครดิต")
creditTab2:CreateLabel("owner by livezala")
creditTab2:CreateLabel("original script by dion_ktl")
creditTab2:CreateLabel("พัฒนาต่อโดย thomas (โทมัส)")
creditTab2:CreateLabel("อัพเดต 31/10/2025")
creditTab2:CreateLabel("Discord: dSyCsRpU62")

-- === ลูปหลัก ===
RS.RenderStepped:Connect(function()
    if flying and vv and gyro and hrp and humanoid then
        local cam = workspace.CurrentCamera
        if not cam then return end
        local forward = Vector3.new(cam.CFrame.LookVector.X, 0, cam.CFrame.LookVector.Z).Unit
        local right = Vector3.new(cam.CFrame.RightVector.X, 0, cam.CFrame.RightVector.Z).Unit
        local moveVec = Vector3.zero
        if UIS:IsKeyDown(Enum.KeyCode.W) then moveVec += forward end
        if UIS:IsKeyDown(Enum.KeyCode.S) then moveVec -= forward end
        if UIS:IsKeyDown(Enum.KeyCode.A) then moveVec -= right end
        if UIS:IsKeyDown(Enum.KeyCode.D) then moveVec += right end
        if UIS:IsKeyDown(Enum.KeyCode.Space) then moveVec += Vector3.new(0,1,0) end
        if UIS:IsKeyDown(Enum.KeyCode.LeftShift) then moveVec += Vector3.new(0,-1,0) end
        if moveVec.Magnitude > 0 then vv.Velocity = moveVec.Unit * flySpeed else vv.Velocity = Vector3.zero end
        if moveVec.X ~= 0 or moveVec.Z ~= 0 then
            gyro.CFrame = CFrame.new(hrp.Position, hrp.Position + Vector3.new(moveVec.X, 0, moveVec.Z))
        end
    end
end)

RS.Stepped:Connect(function()
    if noclipEnabled and char then
        for _,part in pairs(char:GetDescendants()) do
            if part:IsA("BasePart") then part.CanCollide = false end
        end
    end
end)

UIS.JumpRequest:Connect(function()
    if infJumpEnabled and humanoid then
        humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
    end
end)

-- รีเซ็ตเมื่อ respawn
player.CharacterAdded:Connect(function(c)
    char = c
    hrp = c:WaitForChild("HumanoidRootPart")
    humanoid = c:WaitForChild("Humanoid")
    stopFlying()
    toggleSpeed(false)
    noclipEnabled = false
    infJumpEnabled = false
    Rayfield:LoadConfiguration()
end)

Rayfield:Notify({Title="โหลดสำเร็จ!", Content="พร้อมลุย ไลฟ์สาระ ไปวันๆ!", Duration=4, Image=6026568198})
